# Codex Context: GPU-Reseller

## Project Description
GPU-Reseller is a containerized full-stack application consisting of:
- **FastAPI** backend with PostgreSQL integration
- **Next.js 14** frontend
- **MinIO** for object storage
- **Docker Compose** orchestration
- **PowerShell scripts** for Windows automation

## Codex Behavior
When asked for help:
- Always read compose.yaml, api/, web/, and docs/notes.md.
- Keep solutions Windows-compatible.
- Prefer PowerShell for automation tasks.
- Maintain cross-platform (Linux/macOS) compatibility when possible.
- Ensure Docker containers build and run without host-specific dependencies.
- Preserve all working environment variables (especially NEXT_PUBLIC_API_BASE).

## Current Goals
1. Extend API with authentication and user management.
2. Add dashboard visualization for GPU metrics.
3. Harden Docker networking and environment checks.
4. Implement CI/CD readiness (optional future task).

# === GPU-Reseller – Milestone Roadmap (for Codex) ===
project: GPU-Reseller
context:
  description: >
    Full-stack GPU provisioning and monitoring demo project using FastAPI,
    Next.js 14, PostgreSQL, and MinIO, orchestrated via Docker Compose.
  primary_stack:
    backend: FastAPI (Python 3.11)
    frontend: Next.js 14 (Node 20)
    database: PostgreSQL 16
    object_storage: MinIO
    orchestration: Docker Compose
    os_targets: [Windows 11, Linux]

milestones:

  - id: core_stability
    name: Core Stability & Data Flow
    goal: >
      Ensure all containers reach healthy state and data flows correctly
      between DB, API, and Web.
    tasks:
      - Fix migration idempotency using IF NOT EXISTS in SQL.
      - Implement /health endpoint for api, web, db.
      - Add scripts/check-health.ps1 to verify service health.
      - Add depends_on + healthchecks to compose.yaml.
    deliverable: Stable stack; docker compose up -d reaches healthy within 60 s.

  - id: api_expansion
    name: API Expansion
    goal: Expand FastAPI backend for GPU resource and job management.
    tasks:
      - Add /users CRUD endpoints.
      - Add /jobs submission and queue tracking.
      - Introduce Alembic or SQL-based migrations.
      - Add Pydantic validation and pytest coverage.
    deliverable: Functional API with passing tests.

  - id: web_dashboard
    name: Web Dashboard
    goal: Create real-time visualization for regions and GPU stats.
    tasks:
      - Build pages/dashboard.tsx in Next.js 14.
      - Fetch metrics from API every 10 s.
      - Add table/grid for region health/utilization.
      - Style using Tailwind CSS.
    deliverable: Dashboard accessible at http://localhost:3000/dashboard.

  - id: auth_system
    name: Authentication & Authorization
    goal: Implement JWT-based login across API and frontend.
    tasks:
      - Add /auth/login and /auth/register in FastAPI.
      - Implement JWT issuance + middleware validation.
      - Create login form and protected routes in frontend.
    deliverable: Authenticated API and persisted user sessions.

  - id: ci_cd
    name: Automation & CI/CD
    goal: Enable automated build/test and version tagging.
    tasks:
      - Add GitHub Actions for Docker build + test.
      - Integrate version-bump.ps1 and release.yml.
      - Create docker-compose.test.yaml for lightweight CI validation.
    deliverable: Auto-build and tagged releases on every push.

  - id: persistence_analytics
    name: Persistence & Analytics
    goal: Store historical GPU data and render analytics charts.
    tasks:
      - Add daily summarization to region_stats.
      - Implement /reports analytics API.
      - Visualize trends via Chart.js on dashboard.
    deliverable: Historical utilization reports and visual analytics.

meta:
  versioning:
    default_branch: master
    tag_pattern: v<major>.<minor>.<patch>
  automation:
    preferred_script_language: PowerShell
    test_trigger: docker compose run --rm migrator
  owner: RBurns7002
  repository: https://github.com/RBurns7002/gpu-reseller

- id: advanced_telemetry
  name: Advanced Telemetry & Simulation
  goal: >
    Implement accelerated time simulation with live revenue/cost telemetry
    and real-time charts.
  tasks:
    - Add telemetry table and extended region fields.
    - Implement /simulate API endpoint (time-accelerated).
    - Stream live updates via WebSocket.
    - Visualize revenue, utilization, profit trends on dashboard.
  deliverable: Interactive simulation dashboard showing revenue growth in accelerated time.

## Style Guide
- FastAPI routes: concise, typed, and documented.
- Next.js components: functional, clean, minimal CSS.
- Use `.env` for secrets, never hardcode credentials.
- Commit messages: short and descriptive.

## Automation Commands
- When user says “version bump” or “milestone reached”, run:
  `scripts/version-bump.ps1`
